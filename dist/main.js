(()=>{"use strict";var e={907:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function u(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.notasDeleteDetalle=t.notasDelete=t.notasGetDetalle=t.notasPost=t.notasGet=void 0;const i=n(147),r=new class{constructor(e){this.save=function(e,t){return new Promise((function(n,o){if(i.existsSync(t))i.readFile(t,"utf-8",((r,s)=>{if(r)throw o(r),new Error(r);const u=JSON.parse(s);e.id=u.length+1,u.push(e),i.writeFile(t,JSON.stringify(u),(t=>{if(t)throw o(t),new Error(t);n(e.id)}))}));else{let r=[];e.id=1,r[0]=e,i.writeFile(t,JSON.stringify(r),(t=>{if(t)throw o(t),new Error(t);n(e.id)}))}}))},this.getAll=function(e){return o(this,void 0,void 0,(function*(){return new Promise((function(t,n){i.readFile(e,"utf-8",((e,o)=>{if(e)throw n(e),new Error(e);const i=JSON.parse(o);t(i)}))}))}))},this.getById=function(e,t){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(t,"utf-8",((t,o)=>{if(t)throw r(t),new Error(t);const i=JSON.parse(o).find((t=>t.id==e));n(i)}))}))}))}))},this.deleteById=function(e,t){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(t,"utf-8",((o,s)=>{if(o)throw r(o),new Error(o);const u=JSON.parse(s),a=u.findIndex((t=>t.id===e));-1!=a&&u.splice(a,1),i.writeFile(t,JSON.stringify(u),(t=>{if(t)throw r(t),new Error(t);n("Nota eliminada "+e)}))}))}))}))}))},this.deleteAll=function(e){return new Promise((function(t,n){i.writeFile(e,"[]",((e,o)=>{if(e)throw n(e),new Error(e);t("Las notas fueron eliminadas.")}))}))},this.path=e}}("./notas.json");t.notasPost=e=>o(void 0,void 0,void 0,(function*(){return yield r.save(e,"./notas.json")}));t.notasGet=()=>r.getAll("./notas.json"),t.notasGetDetalle=e=>o(void 0,void 0,void 0,(function*(){return yield r.getById(e,"./notas.json")})),t.notasDeleteDetalle=e=>o(void 0,void 0,void 0,(function*(){return yield r.deleteById(e,"./notas.json")})),t.notasDelete=()=>o(void 0,void 0,void 0,(function*(){let e=yield r.deleteAll("./notas.json");console.log(e)}))},479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mainRouter=void 0;const o=(0,n(860).Router)();t.mainRouter=o;const i=n(591);o.use("/notas",i.router)},591:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function u(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const u=(0,n(860).Router)();t.router=u;const a=r(n(907)),d=n(238);u.get("/",(function(e,t){return s(this,void 0,void 0,(function*(){const e=yield a.notasGet();t.render("notas",{notasGet:e})}))})),u.get("/:id",(function(e,t){return s(this,void 0,void 0,(function*(){const n=yield a.notasGetDetalle(e.params.id);n?t.json({notas:n}):t.status(404).json({error:"Nota no encontrada!"})}))})),u.post("/",(function(e,t){return s(this,void 0,void 0,(function*(){const n=yield a.notasPost(e.body),o=(0,d.getWsServer)(),i=yield a.notasGetDetalle(n);o.sockets.emit("NotasCliente",i),t.json({id:n})}))})),u.put("/:id",(function(e,t){return s(this,void 0,void 0,(function*(){const n=yield a.notasGet(),o=n.findIndex((t=>t.id===parseInt(e.params.id)));-1!=o&&(n[o].denominacion=e.body.denominacion,n[o].contenido=e.body.contenido),yield a.notasDelete();for(let e=0;e<n.length;e++){const t=n[e];yield a.notasPost(t)}t.json({status:"Ok",id:e.params.id,nuevo:e.body})}))})),u.delete("/:id",(function(e,t){return s(this,void 0,void 0,(function*(){yield a.notasDeleteDetalle(parseInt(e.params.id)),t.json({status:"Ok",id:e.params.id})}))}))},669:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.httpServer=void 0;const i=o(n(860)),r=n(685),s=n(479),u=o(n(17)),a=n(238),d=(0,i.default)(),c=new r.Server(d);t.httpServer=c,d.use(i.default.json()),d.use(i.default.urlencoded({extended:!0})),d.use(i.default.static("public"));const l=u.default.resolve(__dirname,"../../vistas");d.set("view engine","ejs"),d.set("views",l),(0,a.initWsServer)(c),d.use("/api",s.mainRouter)},238:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function u(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getWsServer=t.initWsServer=void 0;const i=n(952),r=n(907);let s;t.initWsServer=e=>(s=i(e),s.on("connection",(e=>o(void 0,void 0,void 0,(function*(){console.log("Se conecto un nuevo usuario....");const e=yield r.notasGet();s.sockets.emit("Notas",e)})))),s),t.getWsServer=()=>s},860:e=>{e.exports=require("express")},952:e=>{e.exports=require("socket.io")},147:e=>{e.exports=require("fs")},685:e=>{e.exports=require("http")},17:e=>{e.exports=require("path")}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(()=>{const e=n(669);e.httpServer.listen(8080,(()=>{console.log("Servidor escuchando en el puerto 8080")})),e.httpServer.on("error",(e=>console.log(`Error en servidor ${e}`)))})()})();