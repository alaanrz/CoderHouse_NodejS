(()=>{"use strict";var t={717:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(n(185));i(n(142)).default.config();const s=process.env.MONGO_ATLAS||"mongodb://localhost:27017/ecommerce";e.default=()=>o(void 0,void 0,void 0,(function*(){try{yield r.default.connect(s)}catch(t){return console.log(`ERROR => ${t}`),t}}))},31:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.notasDeleteDetalle=e.notasDelete=e.notasGetDetalle=e.notasPost=e.notasGet=void 0;const i=n(147),r=new class{constructor(t){this.save=function(t,e){return new Promise((function(n,o){if(i.existsSync(e))i.readFile(e,"utf-8",((r,s)=>{if(r)throw o(r),new Error(r);const a=JSON.parse(s);let u={id:a.length+1,notas:[t]};a.push(u),i.writeFile(e,JSON.stringify(a),(t=>{if(t)throw o(t),new Error(t);n(u.id)}))}));else{let r=[{id:1,notas:[t]}];i.writeFile(e,JSON.stringify(r),(t=>{if(t)throw o(t),new Error(t);n(r[0].id)}))}}))},this.getAll=function(t){return o(this,void 0,void 0,(function*(){return new Promise((function(e,n){i.readFile(t,"utf-8",((t,o)=>{if(t)throw n(t),new Error(t);const i=JSON.parse(o);e(i)}))}))}))},this.getById=function(t,e){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(e,"utf-8",((e,o)=>{if(e)throw r(e),new Error(e);const i=JSON.parse(o).find((e=>e.id==t));n(i.notas)}))}))}))}))},this.deleteById=function(t,e){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(e,"utf-8",((o,s)=>{if(o)throw r(o),new Error(o);const a=JSON.parse(s),u=a.findIndex((e=>e.id===t));-1!=u&&a.splice(u,1),i.writeFile(e,JSON.stringify(a),(e=>{if(e)throw r(e),new Error(e);n("Nota eliminada "+t)}))}))}))}))}))},this.deleteAll=function(t){return new Promise((function(e,n){i.writeFile(t,"[]",((t,o)=>{if(t)throw n(t),new Error(t);e("Las notas fueron eliminadas.")}))}))},this.path=t}}("./carrito.json");e.notasPost=t=>o(void 0,void 0,void 0,(function*(){return yield r.save(t,"./carrito.json")})),e.notasGet=()=>r.getAll("./carrito.json"),e.notasGetDetalle=t=>o(void 0,void 0,void 0,(function*(){return yield r.getById(t,"./carrito.json")})),e.notasDeleteDetalle=t=>o(void 0,void 0,void 0,(function*(){return yield r.deleteById(t,"./carrito.json")})),e.notasDelete=()=>o(void 0,void 0,void 0,(function*(){yield r.deleteAll("./carrito.json")}))},133:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default={administrador:!0}},519:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=n(669),s=i(n(717));o(void 0,void 0,void 0,(function*(){yield(0,s.default)(),r.httpServer.listen(8080,(()=>{console.log("Servidor escuchando en el puerto 8080")})),r.httpServer.on("error",(t=>console.log(`Error en servidor ${t}`)))}))},71:function(t,e,n){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.validateLogIn=e.authVerification=void 0;const i=o(n(133));e.authVerification=(t,e,n)=>{if(!i.default.administrador)return e.status(401).json({status:"No estas autorizado."});n()},e.validateLogIn=(t,e,n)=>{t.session.info&&t.session.info.loggedIn?n():e.status(401).json({msg:"no estas autorizado"})}},293:function(t,e,n){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.notasModel=e.notasCollectionName=void 0;const i=o(n(185));e.notasCollectionName="notas";const r=new i.default.Schema({denominacion:{type:String,required:!0},contenido:{type:String,required:!0},autor:{id:Number,nombre:String,apellido:String}});e.notasModel=i.default.model(e.notasCollectionName,r)},907:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.notasDeleteDetalle=e.notasDelete=e.notasGetDetalle=e.notasPost=e.notasGet=void 0;const i=n(147),r=new class{constructor(t){this.save=function(t,e){return new Promise((function(n,o){if(i.existsSync(e))i.readFile(e,"utf-8",((r,s)=>{if(r)throw o(r),new Error(r);const a=JSON.parse(s);t.id=a.length+1,a.push(t),i.writeFile(e,JSON.stringify(a),(e=>{if(e)throw o(e),new Error(e);n(t.id)}))}));else{let r=[];t.id=1,r[0]=t,i.writeFile(e,JSON.stringify(r),(e=>{if(e)throw o(e),new Error(e);n(t.id)}))}}))},this.getAll=function(t){return o(this,void 0,void 0,(function*(){return new Promise((function(e,n){i.readFile(t,"utf-8",((t,o)=>{if(t)throw n(t),new Error(t);const i=JSON.parse(o);e(i)}))}))}))},this.getById=function(t,e){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(e,"utf-8",((e,o)=>{if(e)throw r(e),new Error(e);const i=JSON.parse(o).find((e=>e.id==t));n(i)}))}))}))}))},this.deleteById=function(t,e){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(e,"utf-8",((o,s)=>{if(o)throw r(o),new Error(o);const a=JSON.parse(s),u=a.findIndex((e=>e.id===t));-1!=u&&a.splice(u,1),i.writeFile(e,JSON.stringify(a),(e=>{if(e)throw r(e),new Error(e);n("Nota eliminada "+t)}))}))}))}))}))},this.deleteAll=function(t){return new Promise((function(e,n){i.writeFile(t,"[]",((t,o)=>{if(t)throw n(t),new Error(t);e("Las notas fueron eliminadas.")}))}))},this.path=t}}("./notas.json");e.notasPost=t=>o(void 0,void 0,void 0,(function*(){return yield r.save(t,"./notas.json")}));e.notasGet=()=>r.getAll("./notas.json"),e.notasGetDetalle=t=>o(void 0,void 0,void 0,(function*(){return yield r.getById(t,"./notas.json")})),e.notasDeleteDetalle=t=>o(void 0,void 0,void 0,(function*(){return yield r.deleteById(t,"./notas.json")})),e.notasDelete=()=>o(void 0,void 0,void 0,(function*(){let t=yield r.deleteAll("./notas.json");console.log(t)}))},901:function(t,e,n){var o=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,o,i)}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&o(e,t,n);return i(e,t),e},s=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.router=void 0;const a=(0,n(860).Router)();e.router=a;const u=r(n(31)),d=n(977);a.get("/:id",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasGetDetalle(t.params.id);n?e.json({notas:n}):e.status(404).json({error:"Nota no encontrada!"})}))})),a.post("/",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasPost(t.body);e.json({id:n})}))})),a.put("/:id",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasGet(),o=n.findIndex((e=>e.id===parseInt(t.params.id)));-1!=o&&n[o].notas.push(t.body),yield u.notasDelete();try{yield d.writeFile("./carrito.json",JSON.stringify(n)),e.json({status:"Ok",id:t.params.id,nuevo:t.body})}catch(t){e.json({status:t})}}))})),a.delete("/:id",(function(t,e){return s(this,void 0,void 0,(function*(){yield u.notasDeleteDetalle(parseInt(t.params.id)),e.json({status:"Ok",id:t.params.id})}))})),a.delete("/:id/:notaId",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasGet(),o=n.findIndex((e=>e.id===parseInt(t.params.id)));if(-1!=o){const e=n[o].notas.findIndex((e=>e.id===parseInt(t.params.notaId)));-1!=e&&n[o].notas.splice(e,1)}yield u.notasDelete();try{yield d.writeFile("./carrito.json",JSON.stringify(n)),e.json({status:"Ok"})}catch(t){e.json({status:t})}}))}))},479:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.mainRouter=void 0;const o=(0,n(860).Router)();e.mainRouter=o;const i=n(591),r=n(901);o.use("/notas",i.router),o.use("/carrito",r.router)},591:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.router=void 0;const i=(0,n(860).Router)();e.router=i;const r=n(71),s=n(293),a=n(935),u=[{username:"juan",password:"1234",admin:!0},{username:"jose",password:"123456",admin:!1}];i.post("/login",((t,e)=>o(void 0,void 0,void 0,(function*(){const{username:n,password:o}=t.body,i=u.findIndex((t=>t.username===n&&t.password===o));if(i<0)e.status(401).json({msg:"no estas autorizado"});else{const n=u[i];t.session.info={loggedIn:!0,contador:1,username:n.username,admin:n.admin},e.json({msg:"Bienvenido!!",sesion:t.session})}})))),i.get("/secret-endpoint",r.validateLogIn,((t,e)=>o(void 0,void 0,void 0,(function*(){t.session.info&&(t.session.info.contador++,e.json({msg:`${t.session.info.username} ha visitado el sitio ${t.session.info.contador} veces`}))})))),i.post("/logout",((t,e)=>o(void 0,void 0,void 0,(function*(){t.session.destroy((t=>{t?e.send({status:"Logout ERROR",body:t}):e.send("Logout ok!")}))})))),i.get("/info",r.validateLogIn,((t,e)=>o(void 0,void 0,void 0,(function*(){e.send({session:t.session,sessionId:t.sessionID,cookies:t.cookies})}))));const d=[];i.get("/faker",(function(t,e){return o(this,void 0,void 0,(function*(){for(let t=0;t<10;t++)d.push({id:a.faker.datatype.uuid(),denominacion:a.faker.lorem.paragraph(),contenido:a.faker.lorem.paragraph()});e.json({data:d})}))})),i.get("/faker/aleatorio",(function(t,e){return o(this,void 0,void 0,(function*(){const t=d[Math.floor(Math.random()*d.length)];e.json({data:t})}))})),i.get("/",(function(t,e){return o(this,void 0,void 0,(function*(){try{const t=yield s.notasModel.find();e.json({data:t})}catch(t){e.status(500).json({error:t})}}))})),i.get("/normailizacion",(function(t,e){return o(this,void 0,void 0,(function*(){}))})),i.get("/:id",(function(t,e){return o(this,void 0,void 0,(function*(){try{const{id:n}=t.params,o=yield s.notasModel.findById(n);if(!o)return e.status(404).json({msg:"Nota no encontrada!"});e.json({data:o})}catch(t){e.status(500).json({error:t})}}))})),i.post("/",r.authVerification,(function(t,e){return o(this,void 0,void 0,(function*(){try{const{denominacion:n,contenido:o,autor:i}=t.body,r=yield s.notasModel.create({denominacion:n,contenido:o,autor:i});e.status(201).json({data:r})}catch(t){e.status(500).json({error:t})}}))})),i.post("/createTable",r.authVerification,(function(t,e){return o(this,void 0,void 0,(function*(){}))})),i.put("/:id",r.authVerification,(function(t,e){return o(this,void 0,void 0,(function*(){try{const{id:n}=t.params,{denominacion:o,contenido:i}=t.body;if(!(yield s.notasModel.findById(n)))return e.status(404).json({msg:"Nota no encontrada!"});const r=yield s.notasModel.findByIdAndUpdate(n,{denominacion:o,contenido:i},{new:!0});e.json({msg:"Nota actualizada",data:r})}catch(t){e.status(500).json({error:t})}}))})),i.delete("/:id",r.authVerification,(function(t,e){return o(this,void 0,void 0,(function*(){try{const{id:n}=t.params;yield s.notasModel.findByIdAndDelete(n),e.json({msg:"Nota eliminada!"})}catch(t){e.status(500).json({error:t})}}))}))},669:function(t,e,n){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.httpServer=void 0;const i=o(n(860)),r=n(685),s=n(479),a=o(n(17)),u=n(238),d=o(n(470)),c=o(n(710)),f=o(n(508)),l=o(n(730));o(n(142)).default.config();const v={store:l.default.create({mongoUrl:process.env.MONGO_ATLAS,ttl:18e4,autoRemove:"native",crypto:{secret:"1234"}}),secret:"secret",resave:!1,saveUninitialized:!1,cookie:{maxAge:18e4}},h=(0,i.default)(),p=new r.Server(h);e.httpServer=p,h.use((0,d.default)("dev")),h.use(i.default.json()),h.use((0,c.default)()),h.use(i.default.urlencoded({extended:!0})),h.use(i.default.static("public")),h.use((0,f.default)(v));const y=a.default.resolve(__dirname,"../../vistas");h.set("view engine","ejs"),h.set("views",y),(0,u.initWsServer)(p),h.use("/api",s.mainRouter)},238:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getWsServer=e.initWsServer=void 0;const i=n(952),r=n(907);let s;e.initWsServer=t=>(s=i(t),s.on("connection",(t=>o(void 0,void 0,void 0,(function*(){console.log("Se conecto un nuevo usuario....");const t=yield r.notasGet();s.sockets.emit("Notas",t)})))),s),e.getWsServer=()=>s},935:t=>{t.exports=require("@faker-js/faker")},730:t=>{t.exports=require("connect-mongo")},710:t=>{t.exports=require("cookie-parser")},142:t=>{t.exports=require("dotenv")},860:t=>{t.exports=require("express")},508:t=>{t.exports=require("express-session")},185:t=>{t.exports=require("mongoose")},470:t=>{t.exports=require("morgan")},952:t=>{t.exports=require("socket.io")},147:t=>{t.exports=require("fs")},685:t=>{t.exports=require("http")},977:t=>{t.exports=require("node:fs/promises")},17:t=>{t.exports=require("path")}},e={};!function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,n),r.exports}(519)})();