(()=>{"use strict";var t={31:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.notasDeleteDetalle=e.notasDelete=e.notasGetDetalle=e.notasPost=e.notasGet=void 0;const i=n(147),r=new class{constructor(t){this.save=function(t,e){return new Promise((function(n,o){if(i.existsSync(e))i.readFile(e,"utf-8",((r,s)=>{if(r)throw o(r),new Error(r);const a=JSON.parse(s);let u={id:a.length+1,notas:[t]};a.push(u),i.writeFile(e,JSON.stringify(a),(t=>{if(t)throw o(t),new Error(t);n(u.id)}))}));else{let r=[{id:1,notas:[t]}];i.writeFile(e,JSON.stringify(r),(t=>{if(t)throw o(t),new Error(t);n(r[0].id)}))}}))},this.getAll=function(t){return o(this,void 0,void 0,(function*(){return new Promise((function(e,n){i.readFile(t,"utf-8",((t,o)=>{if(t)throw n(t),new Error(t);const i=JSON.parse(o);e(i)}))}))}))},this.getById=function(t,e){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(e,"utf-8",((e,o)=>{if(e)throw r(e),new Error(e);const i=JSON.parse(o).find((e=>e.id==t));n(i.notas)}))}))}))}))},this.deleteById=function(t,e){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(e,"utf-8",((o,s)=>{if(o)throw r(o),new Error(o);const a=JSON.parse(s),u=a.findIndex((e=>e.id===t));-1!=u&&a.splice(u,1),i.writeFile(e,JSON.stringify(a),(e=>{if(e)throw r(e),new Error(e);n("Nota eliminada "+t)}))}))}))}))}))},this.deleteAll=function(t){return new Promise((function(e,n){i.writeFile(t,"[]",((t,o)=>{if(t)throw n(t),new Error(t);e("Las notas fueron eliminadas.")}))}))},this.path=t}}("./carrito.json");e.notasPost=t=>o(void 0,void 0,void 0,(function*(){return yield r.save(t,"./carrito.json")})),e.notasGet=()=>r.getAll("./carrito.json"),e.notasGetDetalle=t=>o(void 0,void 0,void 0,(function*(){return yield r.getById(t,"./carrito.json")})),e.notasDeleteDetalle=t=>o(void 0,void 0,void 0,(function*(){return yield r.deleteById(t,"./carrito.json")})),e.notasDelete=()=>o(void 0,void 0,void 0,(function*(){yield r.deleteAll("./carrito.json")}))},133:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default={administrador:!0}},71:function(t,e,n){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.authVerification=void 0;const i=o(n(133));e.authVerification=(t,e,n)=>{if(!i.default.administrador)return e.status(401).json({status:"No estas autorizado."});n()}},907:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.notasDeleteDetalle=e.notasDelete=e.notasGetDetalle=e.notasPost=e.notasGet=void 0;const i=n(147),r=new class{constructor(t){this.save=function(t,e){return new Promise((function(n,o){if(i.existsSync(e))i.readFile(e,"utf-8",((r,s)=>{if(r)throw o(r),new Error(r);const a=JSON.parse(s);t.id=a.length+1,a.push(t),i.writeFile(e,JSON.stringify(a),(e=>{if(e)throw o(e),new Error(e);n(t.id)}))}));else{let r=[];t.id=1,r[0]=t,i.writeFile(e,JSON.stringify(r),(e=>{if(e)throw o(e),new Error(e);n(t.id)}))}}))},this.getAll=function(t){return o(this,void 0,void 0,(function*(){return new Promise((function(e,n){i.readFile(t,"utf-8",((t,o)=>{if(t)throw n(t),new Error(t);const i=JSON.parse(o);e(i)}))}))}))},this.getById=function(t,e){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(e,"utf-8",((e,o)=>{if(e)throw r(e),new Error(e);const i=JSON.parse(o).find((e=>e.id==t));n(i)}))}))}))}))},this.deleteById=function(t,e){return o(this,void 0,void 0,(function*(){return new Promise((function(n,r){return o(this,void 0,void 0,(function*(){i.readFile(e,"utf-8",((o,s)=>{if(o)throw r(o),new Error(o);const a=JSON.parse(s),u=a.findIndex((e=>e.id===t));-1!=u&&a.splice(u,1),i.writeFile(e,JSON.stringify(a),(e=>{if(e)throw r(e),new Error(e);n("Nota eliminada "+t)}))}))}))}))}))},this.deleteAll=function(t){return new Promise((function(e,n){i.writeFile(t,"[]",((t,o)=>{if(t)throw n(t),new Error(t);e("Las notas fueron eliminadas.")}))}))},this.path=t}}("./notas.json");e.notasPost=t=>o(void 0,void 0,void 0,(function*(){return yield r.save(t,"./notas.json")}));e.notasGet=()=>r.getAll("./notas.json"),e.notasGetDetalle=t=>o(void 0,void 0,void 0,(function*(){return yield r.getById(t,"./notas.json")})),e.notasDeleteDetalle=t=>o(void 0,void 0,void 0,(function*(){return yield r.deleteById(t,"./notas.json")})),e.notasDelete=()=>o(void 0,void 0,void 0,(function*(){let t=yield r.deleteAll("./notas.json");console.log(t)}))},901:function(t,e,n){var o=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,o,i)}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&o(e,t,n);return i(e,t),e},s=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.router=void 0;const a=(0,n(860).Router)();e.router=a;const u=r(n(31)),d=n(977);a.get("/:id",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasGetDetalle(t.params.id);n?e.json({notas:n}):e.status(404).json({error:"Nota no encontrada!"})}))})),a.post("/",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasPost(t.body);e.json({id:n})}))})),a.put("/:id",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasGet(),o=n.findIndex((e=>e.id===parseInt(t.params.id)));-1!=o&&n[o].notas.push(t.body),yield u.notasDelete();try{yield d.writeFile("./carrito.json",JSON.stringify(n)),e.json({status:"Ok",id:t.params.id,nuevo:t.body})}catch(t){e.json({status:t})}}))})),a.delete("/:id",(function(t,e){return s(this,void 0,void 0,(function*(){yield u.notasDeleteDetalle(parseInt(t.params.id)),e.json({status:"Ok",id:t.params.id})}))})),a.delete("/:id/:notaId",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasGet(),o=n.findIndex((e=>e.id===parseInt(t.params.id)));if(-1!=o){const e=n[o].notas.findIndex((e=>e.id===parseInt(t.params.notaId)));-1!=e&&n[o].notas.splice(e,1)}yield u.notasDelete();try{yield d.writeFile("./carrito.json",JSON.stringify(n)),e.json({status:"Ok"})}catch(t){e.json({status:t})}}))}))},479:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.mainRouter=void 0;const o=(0,n(860).Router)();e.mainRouter=o;const i=n(591),r=n(901);o.use("/notas",i.router),o.use("/carrito",r.router)},591:function(t,e,n){var o=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,o,i)}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&o(e,t,n);return i(e,t),e},s=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.router=void 0;const a=(0,n(860).Router)();e.router=a;const u=r(n(907)),d=n(238),c=n(71);a.get("/",(function(t,e){return s(this,void 0,void 0,(function*(){const t=yield u.notasGet();e.json({notas:t})}))})),a.get("/:id",(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasGetDetalle(t.params.id);n?e.json({notas:n}):e.status(404).json({error:"Nota no encontrada!"})}))})),a.post("/",c.authVerification,(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasPost(t.body),o=(0,d.getWsServer)(),i=yield u.notasGetDetalle(n);o.sockets.emit("NotasCliente",i),e.json({id:n})}))})),a.put("/:id",c.authVerification,(function(t,e){return s(this,void 0,void 0,(function*(){const n=yield u.notasGet(),o=n.findIndex((e=>e.id===parseInt(t.params.id)));-1!=o&&(n[o].denominacion=t.body.denominacion,n[o].contenido=t.body.contenido),yield u.notasDelete();for(let t=0;t<n.length;t++){const e=n[t];yield u.notasPost(e)}e.json({status:"Ok",id:t.params.id,nuevo:t.body})}))})),a.delete("/:id",c.authVerification,(function(t,e){return s(this,void 0,void 0,(function*(){yield u.notasDeleteDetalle(parseInt(t.params.id)),e.json({status:"Ok",id:t.params.id})}))}))},669:function(t,e,n){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.httpServer=void 0;const i=o(n(860)),r=n(685),s=n(479),a=o(n(17)),u=n(238),d=(0,i.default)(),c=new r.Server(d);e.httpServer=c,d.use(i.default.json()),d.use(i.default.urlencoded({extended:!0})),d.use(i.default.static("public"));const l=a.default.resolve(__dirname,"../../vistas");d.set("view engine","ejs"),d.set("views",l),(0,u.initWsServer)(c),d.use("/api",s.mainRouter)},238:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getWsServer=e.initWsServer=void 0;const i=n(952),r=n(907);let s;e.initWsServer=t=>(s=i(t),s.on("connection",(t=>o(void 0,void 0,void 0,(function*(){console.log("Se conecto un nuevo usuario....");const t=yield r.notasGet();s.sockets.emit("Notas",t)})))),s),e.getWsServer=()=>s},860:t=>{t.exports=require("express")},952:t=>{t.exports=require("socket.io")},147:t=>{t.exports=require("fs")},685:t=>{t.exports=require("http")},977:t=>{t.exports=require("node:fs/promises")},17:t=>{t.exports=require("path")}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,n),r.exports}(()=>{const t=n(669);t.httpServer.listen(8080,(()=>{console.log("Servidor escuchando en el puerto 8080")})),t.httpServer.on("error",(t=>console.log(`Error en servidor ${t}`)))})()})();